- name: Install GNU stow
  become: yes
  ansible.builtin.package:
    name:
      - stow

- name: Clone dotfiles repository
  ansible.builtin.git:
    repo: git@github.com:evanjamesjackson/dotfiles.git
    key_file: "{{ github_key_file }}"
    dest: "{{ home_directory }}/dotfiles"
    version: "{{ dotfiles_branch }}"

- name: Symlink dotfiles using GNU stow
  ansible.builtin.shell:
    chdir: "{{ home_directory }}/dotfiles"
    cmd: stow *
  register: result
  changed_when: result != 0
